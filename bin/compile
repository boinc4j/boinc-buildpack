#!/usr/bin/env bash

# fail fast
set -eu

indent() {
  sed -u 's/^/       /'
}

# parse args
BUILD_DIR=$1
CACHE_DIR=$2

BP_DIR="$(cd "$(dirname "$0")" && pwd)"
OPT_DIR=$BP_DIR/../opt/

#### Download BOINC source
echo -n "-----> Downloading BOINC... "
BOINC_DIR=/tmp/boinc-src
mkdir -p $BOINC_DIR
curl --silent --retry 3 -L https://api.github.com/repos/BOINC/boinc/tarball/master | tar xzm -C $BOINC_DIR --strip-components=1

cd $BOINC_DIR
./_autosetup
./configure --disable-client --disable-manager
make

mkdir -p $BUILD_DIR/boinc
cp -R * $BUILD_DIR/boinc
